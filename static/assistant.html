<!DOCTYPE html>
<html class="spectrum spectrum--medium spectrum--light">
  <head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://use.typekit.net/zdg6wra.css">
    <title>Experience AI Catalyst</title>
    <link rel="stylesheet" href="spectrum.css">
    <link rel="stylesheet" href="styles.css">
  </head>
  <body>
    <script>
      const STEP_2_AEM_URL = 'https://destyled--frescopa--coatpont.aem.page/';

      document.onReady = () => {
        const steps = [
          {
            id: 'step-1',
            title: 'Step 1 - Onboarding',
          }
        ]

        debugger;

      };
      document.onreadystatechange = async function() {
        if (document.readyState === "complete") {
          console.log("Page is loaded completely!");

          document.querySelectorAll('.ass-step-1.ui-item-4 a').forEach(a => {
            a.href = STEP_2_AEM_URL;
          });

          /**
           * 1. Get the URL of the current page to 
           * automatically populate the onboarding step
           */

          const isIframe = window.self !== window.top;
          const url = isIframe ? document.referrer : document.location.href;

          if (url) {
            const el = document.querySelector('.ass-step-1.ui-item-1 .ass-step-analyse-website span');
            if (el) {
              el.innerHTML = `Analyzing ${url} <span class="ellipsis">...</span>`;
            }
          }

          /**
           * Wait for 2.666 seconds to simulate the analysis
           * 2. Mark the analysis step as done and enable the onboarding button if the URL is valid
           */

          await new Promise(resolve => setTimeout(resolve, 2666));

          document.querySelectorAll('.ass-step-1.ui-item-1 div.spinner').forEach(sp => {
            sp.classList.add('done');
          });
          document.querySelectorAll('.ass-step-1.ui-item-1 .ellipsis').forEach(el => el.remove());

          const button = document.querySelector('#assistant-content-input-button');
          if (button) {
            button.removeAttribute('disabled');
          }
        }
      };

      async function doImport() {
        await new Promise(resolve => setTimeout(resolve, 137));
        document.querySelectorAll('.ass-step-1.ui-item-3').forEach(li => {
          li.style.opacity = 1;
        });

          /**
           * 3. Mark the onboarding steps as done
           */

          await new Promise(resolve => setTimeout(resolve, 3784));

          document.querySelectorAll('.ass-step-1.ui-item-3 .ui-item-1 div.spinner').forEach(sp => {
            sp.classList.add('done');
          });
          document.querySelectorAll('.ass-step-1.ui-item-3 .ui-item-1 .ellipsis').forEach(el => el.remove());

          await new Promise(resolve => setTimeout(resolve, 2465));

          document.querySelectorAll('.ass-step-1.ui-item-3 .ui-item-2 div.spinner').forEach(sp => {
            sp.classList.add('done');
          });
          document.querySelectorAll('.ass-step-1.ui-item-3 .ui-item-2 .ellipsis').forEach(el => el.remove());

          document.querySelectorAll('.ass-step-1.ui-item-4').forEach(li => {
            li.style.display = 'block';
          });

      }
    </script>
    </script>
    <div id="assistant">
      <div id="assistant-header">
        <div id="assistant-header-title">
          <h3>Experience AI Catalyst</h3>
        </div>
      </div>
      <hr>
      <h4>Step 1 - Onboarding</h4>
      <div class="main-container">
        <div class="ass-step-1 ui-item-1">
          <ul class="ass-step-analyse-website">
            <li>
              <div class="progress-bar">
                <div class="spinner"></div>
              </div>
              <span>Analyzing <span class="ellipsis">...</span></span>
            </li>
          </ul>
        </div>
        <div class="ass-step-1 ui-item-2">
          <button class="ai-button" id="assistant-content-input-button" onclick="doImport()" disabled>
            <img src="./ai-magic.svg" alt="AI Magic" style="width: 16px; height: 16px; margin-right: 6px;"> ONBOARD
          </button>
        </div>
      </div>
      <div id="assistant-content">
        <div id="assistant-content-input">
        </div>
        <div class="ass-step-1 ui-item-3">
          <ul id="assistant-content-output-steps">
            <li id="assistant-content-output-step-2" class="ui-item-1">
              <div id="assistant-content-output-step-2-progress" class="progress-bar">
                <div class="spinner"></div>
              </div>
              <span>Creating the project <span class="ellipsis">...</span></span>
            </li>
            <li id="assistant-content-output-step-3" class="ui-item-2">
              <div id="assistant-content-output-step-3-progress" class="progress-bar">
                <div class="spinner"></div>
              </div>
              <span>Importing the site <span class="ellipsis">...</span></span>
            </li>
          </ul>
        </div>
      </div>
      <div class="ass-step-1 ui-item-4">
        <div>
          <span>Access <a href="main page" target="_blank">main page</a> imported in AEM Project </span>
        </div>
      </div>
  </div>
  </body>
</html>
